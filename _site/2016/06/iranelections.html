<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>What does provincial level GDP tell us about Iranian voting habits?</title>
    <meta name="description" content="My musings on politics, pop culture, sports, and pretty much anything else I can find data on.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://cmohamma.github.io/2016/06/iranelections.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Where's the Data?</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">What does provincial level GDP tell us about Iranian voting habits?</h1>
    <p class="post-meta">Jun 12, 2016 • Cyrus Mohammadian</p>
  </header>

  <article class="post-content">
    <p>#Elections in Iran</p>

<p>The recent parliamentary elections in Iran were a big win for the reformist camp. They not only managed to secure a (slim) majority in the Iranian Majles, they were also successful in adding significant numbers of reformist sympathizers to Iran’s Guardian Council -the organizational body tasked with selecting the next Supreme Leader to succeed Ayatollah Khamenei. A cursory examination of the results suggest that reformists performed particularly well in urban districts throughout the country and in Tehran in particular. One particular narrative that has emerged is that the upper class in Iran tend to vote reformist, while the working class poor gravitate towards the principalist camp.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> I bring this narrative under closer scrutiny using publicaly available data on the recent presidential and legislative elections.</p>

<p>Before getting into the data, I’ll provide some background on the mechanics of Iranian elections and the current political climate in the country. Then I’ll go through the workflow of my analysis, which begins with scraping data from the web, cleaning it, graphing it, and then plotting a few correlations that examine the effect of provincial level economic well being on Iranian voting habits.</p>

<p>##Presidential and Legislative Elections in Iran</p>

<p>Iran follows a two-round mixed-member district electoral voting system for its 290 member legislative body, which means 1) voters have the opporunity to elect one or more representatives per constituency and 2) leading candidates must secure at least 30% of the vote share in order to avoid a run-off against their nearest opponent. The numbers of seats is roughly allocated according to district population size. Districts size maxes out at 30 seats in Tehran, while the next largest is Tabriz with 6 and the the modal district size is 1. Of the 290 seats, 5 seats are reserved for officialy recognized religious minorities -one seat for Zoroastrians, one seat for Jews, two seats for Armenian Christians (North and South), and one seat for Assyrian and Chaldean Christians.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotrix</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">

</span><span class="n">election</span><span class="o">&lt;-</span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">seats</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">formula</span><span class="p">,</span><span class="w">
 </span><span class="n">colours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">rainbow</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">counts</span><span class="p">))))</span><span class="w"> </span><span class="p">{</span><span class="w">
 
 </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">model.frame</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w">
 </span><span class="n">counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">result</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
 </span><span class="n">stopifnot</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">seats</span><span class="p">))</span><span class="w">
 </span><span class="n">seats</span><span class="o">$</span><span class="n">party</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="n">result</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">counts</span><span class="p">))</span><span class="w">
 </span><span class="n">seats</span><span class="o">$</span><span class="n">colour</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colours</span><span class="p">[</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">seats</span><span class="o">$</span><span class="n">party</span><span class="p">)]</span><span class="w">
 </span><span class="n">seats</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">colour</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"lightgreen"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"darkgreen"</span><span class="p">,</span><span class="s2">"yellow"</span><span class="p">,</span><span class="s2">"purple"</span><span class="p">,</span><span class="s2">"darkgrey"</span><span class="p">)</span><span class="w">
</span><span class="n">party</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Tehran"</span><span class="p">,</span><span class="s2">"Tabriz"</span><span class="p">,</span><span class="s2">"Isfahan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mashad"</span><span class="p">,</span><span class="s2">"Minorities"</span><span class="p">,</span><span class="s2">"Rest"</span><span class="p">)</span><span class="w">
</span><span class="n">members</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">239</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">data.frame</span><span class="p">(</span><span class="n">colour</span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="p">,</span><span class="w"> </span><span class="n">members</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">mutate_if</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">is.factor</span><span class="p">,</span><span class="w"> </span><span class="n">as.character</span><span class="p">)</span><span class="w">
</span><span class="n">majles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seats</span><span class="p">(</span><span class="m">290</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">data.e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">election</span><span class="p">(</span><span class="n">majles</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">members</span><span class="p">)</span><span class="w">

</span><span class="n">blank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.line</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.text.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.text.y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.ticks</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.title.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.title.y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">panel.background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">panel.border</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">panel.grid.major</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">panel.grid.minor</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">plot.background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">legend.title</span><span class="o">=</span><span class="n">element_blank</span><span class="p">())</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data.e</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">party</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">blank</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Rest"</span><span class="p">,</span><span class="s2">"Tehran"</span><span class="p">,</span><span class="s2">"Tabriz"</span><span class="p">,</span><span class="s2">"Isfahan"</span><span class="p">,</span><span class="s2">"Mashad"</span><span class="p">,</span><span class="s2">"Minorities"</span><span class="p">),</span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Rest"</span><span class="p">,</span><span class="s2">"Minorities"</span><span class="p">,</span><span class="s2">"Isfahan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mashad"</span><span class="p">,</span><span class="s2">"Tabriz"</span><span class="p">,</span><span class="s2">"Tehran"</span><span class="p">),</span><span class="w">
                     </span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"yellow"</span><span class="p">,</span><span class="s2">"darkgrey"</span><span class="p">,</span><span class="s2">"purple"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"bottom"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">annotate</span><span class="p">(</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.15</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"290"</span><span class="p">)</span></code></pre></figure>

<p><img src="figure/source/2016-06-12-iranelections/unnamed-chunk-1-1.png" title="plot of chunk unnamed-chunk-1" alt="plot of chunk unnamed-chunk-1" style="display: block; margin: auto 0 auto auto;" /></p>

<p>##A Word About Parties in Iran</p>

<p>Iran does not have parties in the traditional sense of ideologically and strategically coherent political groups. This is in part due to norms that developed in the tumultuous atmosphere in which the Islamic Republic emerged. At the time of the revolution in 1979, the political lanscape was a checkerboard of various opposition groups united only by their will to collapse the Shah’s regime. Once the monarchy fell a tentative alliance emerged between the Islamist and Nationalist camps, perhaps best exemplified by the working relationship between Ayatollah Khomeini and Abolhassan Bani Sadr. Just as relations between them soured (tension between the two culminated in Bani Sadr’s resignation of the presidency and escape to France), so too did the tentative alliance between Nationalist and Islamist factions. Ultimately, the latter would emerge as triumphet. The harsh break with the Nationalists over the hostage taking crisis (amongst other disagreements), coupled with Saddam’s attack on Iran, allowed the Islamist faction to consolidate its power at the ballot box. As a result, although minor ideological factions emerged in the Islamic Republic’s nascent Constitutive Assembly, nothing resembling strong rivalrous parties took root.</p>

<p>In addition to the political climate that was unfavorable to the emergence of a strong party system in Iran, Iran’s Supreme Leader, Ayatollah Khomeini, harbored some <a href="http://www.bashgah.net/fa/content/show/50239">distrust</a> towards party systems, suggesting that foreign powers may use them as a means to divide and conquer. As result, norms against strong parties emerged. Tentative party lists and alliances are formed but they rarely maintain strategic coherence in a single election let alone consistency across multiple election cycles.</p>

<p>Nonetheless, in the 45 years since the revolution, two nominal factions have emerged -the reformist camp who support increased ties with the West and relaxation of social laws, among other things and the principalist camp who advocate for continued rivalry with Western countries and more stringent controls on social behavior. A small minority of ideological independents also crowd the assembly floor.</p>

<p>In the most recent legislative elections in 2016, the reformist camp were lagely represented by two allied “lists” (other minor moderate groups and independents allied with each list as well); The Pervasive Coalition of Reformists: The Second Step (ائتلاف فراگیر اصلاطلبان: گام دوم), otherwise known as the “list of hope” (لیست امید), lead by Mohammad Reza Aref and the Front for the National Voice (جبهه صدای ملت), led by Ali Motahari. The Principalist faction is represented by only one coalition this election cycle - the Principlists Grand Coalition (ائتلاف بزرگ اصولگرایان), led by Gholam Ali Haddad-Adel. In the most recent presidential elections in 2013, Rouhani ran as a reformer while he faced a slate of conservatives and conservative minded independents. In the next section, I introduce election and recent socioeconomic data on Iran.</p>

<p>##The Data</p>

<p>Data on the 2016 parliamentary elections are scraped from Wikipedia’s persian language entry for that subject matter, while the data on the 2013 presidential election and socioeconomic data are scraped from the <a href="http://irandataportal.syr.edu">Iran Data Portal</a> website hosted at Syracuse University.</p>

<p>The diagram below shows the distribution of Majles seats for each faction following the 2016 elections. Reformists and reformist minded independents won 150 of the 290 seats, Principalists and conservative independents secured 94 seats, and independents managed to attain 5 seats.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotrix</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">

</span><span class="n">election</span><span class="o">&lt;-</span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">seats</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">formula</span><span class="p">,</span><span class="w">
 </span><span class="n">colours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">rainbow</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">counts</span><span class="p">))))</span><span class="w"> </span><span class="p">{</span><span class="w">
 
 </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">model.frame</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w">
 </span><span class="n">counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">result</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
 </span><span class="n">stopifnot</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">seats</span><span class="p">))</span><span class="w">
 </span><span class="n">seats</span><span class="o">$</span><span class="n">party</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="n">result</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">counts</span><span class="p">))</span><span class="w">
 </span><span class="n">seats</span><span class="o">$</span><span class="n">colour</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colours</span><span class="p">[</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">seats</span><span class="o">$</span><span class="n">party</span><span class="p">)]</span><span class="w">
 </span><span class="n">seats</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">colour</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"lightgreen"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"darkgreen"</span><span class="p">,</span><span class="s2">"darkgrey"</span><span class="p">)</span><span class="w">
</span><span class="n">party</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Reformists"</span><span class="p">,</span><span class="s2">"Independents"</span><span class="p">,</span><span class="s2">"Principalist"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Minorities"</span><span class="p">)</span><span class="w">
</span><span class="n">members</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="m">150</span><span class="p">,</span><span class="m">41</span><span class="p">,</span><span class="m">94</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">data.frame</span><span class="p">(</span><span class="n">colour</span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="p">,</span><span class="w"> </span><span class="n">members</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">mutate_if</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">is.factor</span><span class="p">,</span><span class="w"> </span><span class="n">as.character</span><span class="p">)</span><span class="w">
</span><span class="n">majles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seats</span><span class="p">(</span><span class="m">290</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">data.e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">election</span><span class="p">(</span><span class="n">majles</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">members</span><span class="p">)</span><span class="w">


</span><span class="n">blank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.line</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.text.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.text.y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.ticks</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.title.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">axis.title.y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">panel.background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">panel.border</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">panel.grid.major</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">panel.grid.minor</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">plot.background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
              </span><span class="n">legend.title</span><span class="o">=</span><span class="n">element_blank</span><span class="p">())</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data.e</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">party</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">blank</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Reformists"</span><span class="p">,</span><span class="s2">"Independents"</span><span class="p">,</span><span class="s2">"Principalist"</span><span class="p">,</span><span class="s2">"Minorities"</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Reformists"</span><span class="p">,</span><span class="s2">"Independents"</span><span class="p">,</span><span class="s2">"Principalists"</span><span class="p">,</span><span class="s2">"Minorities"</span><span class="p">),</span><span class="w">
                     </span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"yellow"</span><span class="p">,</span><span class="s2">"darkgrey"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"bottom"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">annotate</span><span class="p">(</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.15</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"290"</span><span class="p">)</span></code></pre></figure>

<p><img src="figure/source/2016-06-12-iranelections/unnamed-chunk-2-1.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" style="display: block; margin: auto 0 auto auto;" /></p>

<p>For the analysis below, I aggregated the legislative election results across Iran’s 31 provinces. Because the Islamic Republic uses a multi-member district voting system, each constituency has the opporunity to elect one or more candidates. Thus, to obtain faction vote shares in each province for the most recent legislative election, I have simply divided the number of seats won by each faction in each province by the total number of seats in each province. For example, the province of Zanjan has four voting districts. Of these four, three of them are single-member districts and one has two seats, for a total of five seats for the entire province. Of these five seats, two were won by reformist, two were won by independents, and one was won by a principalist, which results in 40% vote share for reformists and independents and</p>

<p>I’ve also acquired provincial level data on average annual unemployment since 2009, GDP/capita (2013), GDP growth rate (from 2011-2013), Gini index (2013), and population data (2013). The following table shows averages for each of those variables:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Load dependencies
</span><span class="n">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">pipeR</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">translateR</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">XML</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gdata</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gdata</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">maptools</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">)</span><span class="w">

</span><span class="c1">#Pass Plotly username and password to environment
</span><span class="n">Sys.setenv</span><span class="p">(</span><span class="s2">"plotly_username"</span><span class="o">=</span><span class="s2">"cmohamma"</span><span class="p">)</span><span class="w">
</span><span class="n">Sys.setenv</span><span class="p">(</span><span class="s2">"plotly_api_key"</span><span class="o">=</span><span class="s2">"udr1tkmg4f"</span><span class="p">)</span><span class="w">

</span><span class="c1">#Scrape table from Wikipedia
</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://fa.wikipedia.org/wiki/فهرست_نمایندگان_دوره_دهم_مجلس_شورای_اسلامی"</span><span class="w">

</span><span class="n">ir.election2016</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">read_html</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">html_nodes</span><span class="p">(</span><span class="n">xpath</span><span class="o">=</span><span class="s1">'//*[@id="mw-content-text"]/table'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">html_table</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">&lt;-</span><span class="n">ir.election2016</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="w">

</span><span class="c1">#Translate column names into English
</span><span class="n">colnames</span><span class="p">(</span><span class="n">ir.election2016</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"district"</span><span class="p">,</span><span class="s2">"province"</span><span class="p">,</span><span class="s2">"coalition"</span><span class="p">,</span><span class="s2">"nothing"</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">nothing</span><span class="o">&lt;-</span><span class="kc">NULL</span><span class="w">

</span><span class="c1">#Get rid of numbers of special characters using regex
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">coalition</span><span class="o">&lt;-</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">coalition</span><span class="p">,</span><span class="w"> </span><span class="s2">"[\\]۱۲۳۴۴۵۶۷۸۹۰\\[]"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">coalition</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">coalition</span><span class="o">==</span><span class="s2">""</span><span class="p">]</span><span class="o">&lt;-</span><span class="kc">NA</span><span class="w">

</span><span class="c1">#Translate all data but politician names into English
</span><span class="n">ir.election2016</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">==</span><span class="s2">"لرستان"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Lorestan"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">coalition.eng</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">translate</span><span class="p">(</span><span class="n">content.vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">coalition</span><span class="p">,</span><span class="w">
                                           </span><span class="n">microsoft.client.id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"thelakerswon"</span><span class="p">,</span><span class="w">
                                           </span><span class="n">microsoft.client.secret</span><span class="w"> </span><span class="o">=</span><span class="w">
                                             </span><span class="s2">"GYIGd9nDwphSSTeGc+VVeDwn1RRGi86o1p4No1effYs="</span><span class="p">,</span><span class="w">
                                           </span><span class="n">source.lang</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">"fa"</span><span class="w"> </span><span class="p">,</span><span class="w">
                                           </span><span class="n">target.lang</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">"en"</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">translate</span><span class="p">(</span><span class="n">content.vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province</span><span class="p">,</span><span class="w">
                                          </span><span class="n">microsoft.client.id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"thelakerswon"</span><span class="p">,</span><span class="w">
                                          </span><span class="n">microsoft.client.secret</span><span class="w"> </span><span class="o">=</span><span class="w">
                                            </span><span class="s2">"GYIGd9nDwphSSTeGc+VVeDwn1RRGi86o1p4No1effYs="</span><span class="p">,</span><span class="w">
                                          </span><span class="n">source.lang</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">"fa"</span><span class="w"> </span><span class="p">,</span><span class="w">
                                          </span><span class="n">target.lang</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">"en"</span><span class="w"> </span><span class="p">)</span><span class="w">

</span><span class="c1">#Clean province names and remove data for ethnic minorities
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Isfahan, Iran"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Isfahan"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Khuzestan province"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Khuzestan"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Semnan, Iran"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Semnan"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Gillan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Gilan"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Bushehr port"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Bushehr"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Fars."</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Fars"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Central"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Markazi"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Chaharmahal and Bakhtiari"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Chahar Mahal and Bakhtiari"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Ardabil"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Ardebil"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"West Azarbaijan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"West Azerbaijan"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="o">==</span><span class="s2">"Kohgiluyeh and Boyer-Ahmad"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Kohgiluyeh and Buyer Ahmad"</span><span class="w">

</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">coalition.eng</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">coalition.eng</span><span class="o">==</span><span class="s2">"NA"</span><span class="p">]</span><span class="o">&lt;-</span><span class="kc">NA</span><span class="w">
</span><span class="n">ir.election2016</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ir.election2016</span><span class="p">[</span><span class="o">-</span><span class="n">grep</span><span class="p">(</span><span class="s2">"Iran"</span><span class="p">,</span><span class="w"> </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">province.eng</span><span class="p">,</span><span class="w"> </span><span class="n">perl</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1">#Convert coalitions to ideology
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">coalition.eng</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"NA"</span><span class="p">]</span><span class="o">&lt;-</span><span class="kc">NA</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"Independent"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"independent"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"The great coalition of conservatives _ the second stage of"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"reformist"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"The reformist Coalition inclusive"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"reformist"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"Moderation and development party"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"reformist"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"The voice of the nation"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"reformist"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"Probe"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"principlist"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"The great coalition of conservatives"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"principlist"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"Revolutionary Trustees"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"principlist"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"The great coalition of conservatives اصلاحطلبانائتلاف inclusive"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"principlist"</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"The reformist Coalition encompassing the great coalition of conservatives"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"principlist"</span><span class="w">

</span><span class="c1">#Inspect independents and convert to appropriate ideology based on wikipedia bios in persian
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">&lt;</span><span class="m">-1</span><span class="o">:</span><span class="m">284</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"7"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"reformist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"11"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"reformist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"24"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"reformist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"29"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"reformist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"30"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"37"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"38"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"54"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"59"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"143"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"148"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"151"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"163"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"173"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"reformist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"178"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"reformist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"214"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"217"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"221"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"241"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"242"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"258"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"reformist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"268"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"reformist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"57"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"58"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"115"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"reformist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="w"> </span><span class="s2">"127"</span><span class="p">,</span><span class="w">
                                 </span><span class="s2">"principlist"</span><span class="p">,</span><span class="w">
                                 </span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ir.election2016</span><span class="o">$</span><span class="n">ideology</span><span class="p">)]</span><span class="o">&lt;-</span><span class="s2">"independent"</span><span class="w">

</span><span class="c1">#Split data between reformist, principlist, and independents
</span><span class="n">reformist.df</span><span class="o">&lt;-</span><span class="n">ir.election2016</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">subset</span><span class="p">(</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"reformist"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">province.eng</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">reformist</span><span class="o">=</span><span class="n">n</span><span class="p">())</span><span class="w">
</span><span class="n">reformist.df</span><span class="o">&lt;-</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">reformist.df</span><span class="p">)</span><span class="w">
</span><span class="n">principlist.df</span><span class="o">&lt;-</span><span class="n">ir.election2016</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">subset</span><span class="p">(</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"principlist"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">province.eng</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">principlist</span><span class="o">=</span><span class="n">n</span><span class="p">())</span><span class="w">
</span><span class="n">principlist.df</span><span class="o">&lt;-</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">principlist.df</span><span class="p">)</span><span class="w">
</span><span class="n">independent.df</span><span class="o">&lt;-</span><span class="n">ir.election2016</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">subset</span><span class="p">(</span><span class="n">ideology</span><span class="o">==</span><span class="s2">"independent"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">province.eng</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">independent</span><span class="o">=</span><span class="n">n</span><span class="p">())</span><span class="w">
</span><span class="n">independent.df</span><span class="o">&lt;-</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">independent.df</span><span class="p">)</span><span class="w">

</span><span class="c1">#Merge the split dataframes together
</span><span class="n">ir.election2016.sum</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">reformist.df</span><span class="p">,</span><span class="w"> </span><span class="n">principlist.df</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"province.eng"</span><span class="p">,</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016.sum</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">ir.election2016.sum</span><span class="p">,</span><span class="w"> </span><span class="n">independent.df</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"province.eng"</span><span class="p">,</span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016.sum</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ir.election2016.sum</span><span class="p">)]</span><span class="o">&lt;</span><span class="m">-0</span><span class="w">

</span><span class="c1">#Construct two-ideology vote share and independent vote share for each district
</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">reform_rat</span><span class="o">&lt;-</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">reformist</span><span class="o">/</span><span class="p">(</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">reformist</span><span class="o">+</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">principlist</span><span class="o">+</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">independent</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">princ_rat</span><span class="o">&lt;-</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">principlist</span><span class="o">/</span><span class="p">(</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">reformist</span><span class="o">+</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">principlist</span><span class="o">+</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">independent</span><span class="p">)</span><span class="w">
</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">indep_rat</span><span class="o">&lt;-</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">independent</span><span class="o">/</span><span class="p">(</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">reformist</span><span class="o">+</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">principlist</span><span class="o">+</span><span class="n">ir.election2016.sum</span><span class="o">$</span><span class="n">independent</span><span class="p">)</span><span class="w">

</span><span class="c1">#Rename province variable
</span><span class="n">ir.election2016.sum</span><span class="o">&lt;-</span><span class="n">rename</span><span class="p">(</span><span class="n">ir.election2016.sum</span><span class="p">,</span><span class="w"> </span><span class="n">province</span><span class="o">=</span><span class="n">province.eng</span><span class="p">)</span><span class="w">

</span><span class="c1">##Presidency 2013
#Scrape table Iran Data Portal
</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"http://irandataportal.syr.edu/election-data"</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">read_html</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">html_nodes</span><span class="p">(</span><span class="n">xpath</span><span class="o">=</span><span class="s1">'//*[@id="content"]/div[16]/table'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">html_table</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">&lt;-</span><span class="n">ir.pres2013</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">ir.pres2013</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"province"</span><span class="p">,</span><span class="s2">"Rouhani"</span><span class="p">,</span><span class="s2">"Velayati"</span><span class="p">,</span><span class="s2">"Jalili"</span><span class="p">,</span><span class="s2">"Ghalibaf"</span><span class="p">,</span><span class="s2">"Rezai"</span><span class="p">,</span><span class="s2">"Gharazi"</span><span class="p">)</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">&lt;-</span><span class="n">ir.pres2013</span><span class="p">[</span><span class="m">-1</span><span class="p">,]</span><span class="w">

</span><span class="c1">#Get rid of unnecessary rows
</span><span class="n">ir.pres2013</span><span class="o">&lt;-</span><span class="n">ir.pres2013</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">subset</span><span class="p">(</span><span class="n">province</span><span class="o">!=</span><span class="s2">"Votes Per Candidate"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">subset</span><span class="p">(</span><span class="n">province</span><span class="o">!=</span><span class="s2">"Total Votes"</span><span class="p">)</span><span class="w">

</span><span class="c1">#remove odd characters and convert data to numeric
</span><span class="n">mystery_char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rawToChar</span><span class="p">(</span><span class="nf">as.raw</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="mh">0xc2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa0</span><span class="p">)))</span><span class="w">
</span><span class="n">to_replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s1">'[,%s]'</span><span class="p">,</span><span class="w"> </span><span class="n">mystery_char</span><span class="p">)</span><span class="w">
</span><span class="n">clean_numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">to_replace</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">))</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir.pres2013</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate_each</span><span class="p">(</span><span class="n">funs</span><span class="p">(</span><span class="n">clean_numbers</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="n">province</span><span class="p">)</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">total</span><span class="o">&lt;-</span><span class="nf">sum</span><span class="p">(</span><span class="n">ir.pres2013</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">7</span><span class="p">])</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">total</span><span class="o">&lt;-</span><span class="n">rowSums</span><span class="p">(</span><span class="n">ir.pres2013</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">7</span><span class="p">])</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">rouhani_rat</span><span class="o">&lt;-</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">Rouhani</span><span class="o">/</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">total</span><span class="w">

</span><span class="c1">#Align province names and merge
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Hamadan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Hamedan"</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Esfahan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Isfahan"</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"North Khorasan "</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"North Khorasan"</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"South Khorasan "</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"South Khorasan"</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Razavi Khorasan "</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Khorasan Razavi"</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Ardabil"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Ardebil"</span><span class="w">
</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">ir.pres2013</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Razavi Khorasan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Khorasan Razavi"</span><span class="w">
</span><span class="n">iran.elect</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">ir.pres2013</span><span class="p">,</span><span class="n">ir.election2016.sum</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"province"</span><span class="p">)</span><span class="w">

</span><span class="c1">###Socioeconomic data
##Population
</span><span class="w">
</span><span class="n">url</span><span class="o">&lt;-</span><span class="s2">"http://irandataportal.syr.edu/wp-content/uploads/population-province-and-gender-census-2011.xlsx"</span><span class="w">
</span><span class="n">pop</span><span class="o">&lt;-</span><span class="n">read.xls</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">
</span><span class="n">pop</span><span class="o">&lt;-</span><span class="n">subset</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span><span class="w"> </span><span class="n">Province</span><span class="o">!=</span><span class="s2">"Total Country"</span><span class="p">)</span><span class="w">
</span><span class="n">rownames</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">&lt;</span><span class="m">-1</span><span class="o">:</span><span class="m">31</span><span class="w">
</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="o">&lt;-</span><span class="n">pop</span><span class="o">$</span><span class="n">Province</span><span class="w">
</span><span class="n">pop</span><span class="o">$</span><span class="n">Province</span><span class="o">&lt;-</span><span class="kc">NULL</span><span class="w">
</span><span class="n">pop</span><span class="o">&lt;-</span><span class="n">select</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span><span class="w"> </span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="n">Male</span><span class="p">,</span><span class="w"> </span><span class="n">Female</span><span class="p">,</span><span class="w"> </span><span class="n">Total</span><span class="p">)</span><span class="w">
</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="p">)</span><span class="w">
</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Hamadan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Hamedan"</span><span class="w">
</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Esfahan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Isfahan"</span><span class="w">
</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"North Khorasan "</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"North Khorasan"</span><span class="w">
</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"South Khorasan "</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"South Khorasan"</span><span class="w">
</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">pop</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Razavi Khorasan "</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Khorasan Razavi"</span><span class="w">

</span><span class="n">iran.elect</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.elect</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Ardebil"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Ardabil"</span><span class="w">
</span><span class="n">iran.df</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span><span class="w"> </span><span class="n">iran.elect</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"province"</span><span class="p">,</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1">##Gini
</span><span class="n">url</span><span class="o">&lt;-</span><span class="s2">"http://irandataportal.syr.edu/wp-content/uploads/GINI-by-Province-1.xlsx"</span><span class="w">
</span><span class="n">iran.df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">read.xls</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">subset</span><span class="p">(</span><span class="n">X</span><span class="o">!=</span><span class="s2">"Iran (total)"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">province</span><span class="o">=</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">gini</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">])</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="n">gini</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"Hamadan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hamedan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"Esfahan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Isfahan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"North Khorasan "</span><span class="p">,</span><span class="w"> </span><span class="s2">"North Khorasan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"South Khorasan "</span><span class="p">,</span><span class="w"> </span><span class="s2">"South Khorasan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"Razavi Khorasan "</span><span class="p">,</span><span class="w"> </span><span class="s2">"Khorasan Razavi"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">merge</span><span class="p">(</span><span class="n">iran.df</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"province"</span><span class="p">,</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">population</span><span class="o">=</span><span class="n">Total</span><span class="p">,</span><span class="w"> </span><span class="n">female_pop</span><span class="o">=</span><span class="n">Female</span><span class="p">,</span><span class="w"> </span><span class="n">male_pop</span><span class="o">=</span><span class="n">Male</span><span class="p">)</span><span class="w">

</span><span class="c1">##GDP/capita growth rate
</span><span class="n">url</span><span class="o">&lt;-</span><span class="s2">"http://irandataportal.syr.edu/wp-content/uploads/GDP-per-capita-without-oil-2000to2013-1.xlsx"</span><span class="w">
</span><span class="n">growth</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="o">/</span><span class="n">lag</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="m">-1</span><span class="w"> </span><span class="c1">#GDP growth between 2012 and 2013
</span><span class="n">gdpgrow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">read.xls</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">Year..Gregorian.calendar.</span><span class="o">==</span><span class="s2">"2012-2013"</span><span class="w"> </span><span class="o">|</span><span class="w">
           </span><span class="n">Year..Gregorian.calendar.</span><span class="o">==</span><span class="s2">"2013-2014"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="o">:</span><span class="m">35</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">melt</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="s2">"Year..Iranian.calendar."</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">Year..Iranian.calendar.</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">province</span><span class="o">=</span><span class="n">variable</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">gdp.grow</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"Hamadan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hamedan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"Esfahan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Isfahan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"South.Khorasan."</span><span class="p">,</span><span class="w"> </span><span class="s2">"South Khorasan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"North.Khorasan."</span><span class="p">,</span><span class="w"> </span><span class="s2">"North Khorasan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"Razavi.Khorasan."</span><span class="p">,</span><span class="w"> </span><span class="s2">"Khorasan Razavi"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">province</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate_each</span><span class="p">(</span><span class="n">funs</span><span class="p">(</span><span class="n">growth</span><span class="p">),</span><span class="w"> </span><span class="n">gdp.grow</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1">#GDP growth function from above
</span><span class="w">  </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="o">==</span><span class="m">1392</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">gdpgrow</span><span class="o">$</span><span class="n">province</span><span class="o">&lt;-</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">gdpgrow</span><span class="o">$</span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="s2">"[.]"</span><span class="p">,</span><span class="s2">" "</span><span class="p">)</span><span class="w">
</span><span class="n">final</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">gdpgrow</span><span class="p">,</span><span class="w"> </span><span class="n">iran.df</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"province"</span><span class="p">,</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1">##GDP/capita from 2013
</span><span class="n">url</span><span class="o">&lt;-</span><span class="s2">"http://irandataportal.syr.edu/wp-content/uploads/GDP-per-capita-without-oil-2000to2013-1.xlsx"</span><span class="w">
</span><span class="n">gdpcap</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">read.xls</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">Year..Gregorian.calendar.</span><span class="o">==</span><span class="s2">"2013-2014"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="o">:</span><span class="m">35</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">melt</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="s2">"Year..Iranian.calendar."</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">Year..Iranian.calendar.</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">province</span><span class="o">=</span><span class="n">variable</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">gdp.cap</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"Hamadan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hamedan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"Esfahan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Isfahan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"South.Khorasan."</span><span class="p">,</span><span class="w"> </span><span class="s2">"South Khorasan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"North.Khorasan."</span><span class="p">,</span><span class="w"> </span><span class="s2">"North Khorasan"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">province</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">province</span><span class="o">==</span><span class="s2">"Razavi.Khorasan."</span><span class="p">,</span><span class="w"> </span><span class="s2">"Khorasan Razavi"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">province</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">gdpcap</span><span class="o">$</span><span class="n">province</span><span class="o">&lt;-</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">gdpcap</span><span class="o">$</span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="s2">"[.]"</span><span class="p">,</span><span class="s2">" "</span><span class="p">)</span><span class="w">
</span><span class="n">final</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">gdpcap</span><span class="p">,</span><span class="w"> </span><span class="n">final</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"province"</span><span class="p">,</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1">##Unemployment
</span><span class="n">url</span><span class="o">&lt;-</span><span class="s2">"http://irandataportal.syr.edu/wp-content/uploads/3.-economic-participation-and-unemployment-rates-for-populationa-aged-10-and-overa-by-ostan-province-1380-1384-2001-2005.xlsx"</span><span class="w">
</span><span class="n">unemp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">read.xls</span><span class="p">(</span><span class="n">fileEncoding</span><span class="o">=</span><span class="s2">"latin1"</span><span class="p">)</span><span class="w"> </span><span class="c1">#must add this option to get it to import
</span><span class="w">
</span><span class="c1">#Convert factors to characters
</span><span class="n">unemp</span><span class="p">[]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">unemp</span><span class="p">,</span><span class="w"> </span><span class="n">as.character</span><span class="p">)</span><span class="w">
</span><span class="n">unemp</span><span class="o">&lt;-</span><span class="n">unemp</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="o">:</span><span class="m">34</span><span class="p">),]</span><span class="w">
</span><span class="n">unemp</span><span class="o">$</span><span class="n">X</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">unemp</span><span class="o">$</span><span class="n">X</span><span class="p">)</span><span class="w">
</span><span class="n">unemp</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"province"</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">unemp</span><span class="p">)</span><span class="o">&lt;-</span><span class="n">unemp</span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w">
</span><span class="n">unemp</span><span class="o">&lt;-</span><span class="n">unemp</span><span class="p">[</span><span class="m">-1</span><span class="p">,]</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">unemp</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"province"</span><span class="p">,</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">,</span><span class="s2">"d"</span><span class="p">,</span><span class="s2">"E"</span><span class="p">,</span><span class="s2">"f"</span><span class="p">,</span><span class="s2">"g"</span><span class="p">,</span><span class="s2">"H"</span><span class="p">,</span><span class="s2">"i"</span><span class="p">,</span><span class="s2">"j"</span><span class="p">,</span><span class="s2">"K"</span><span class="p">,</span><span class="s2">"l"</span><span class="p">,</span><span class="s2">"m"</span><span class="p">,</span><span class="s2">"N"</span><span class="p">,</span><span class="s2">"o"</span><span class="p">)</span><span class="w">
</span><span class="n">unemp</span><span class="o">&lt;-</span><span class="n">select</span><span class="p">(</span><span class="n">unemp</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">)</span><span class="w">
</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\(2\\)"</span><span class="w">
</span><span class="n">clean_numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">))</span><span class="w">
</span><span class="n">unemp</span><span class="o">&lt;-</span><span class="n">mutate_each</span><span class="p">(</span><span class="n">unemp</span><span class="p">,</span><span class="w"> </span><span class="n">funs</span><span class="p">(</span><span class="n">clean_numbers</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="n">province</span><span class="p">)</span><span class="w">
</span><span class="n">unemp</span><span class="o">$</span><span class="n">Z</span><span class="o">&lt;-</span><span class="p">(</span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">unemp</span><span class="p">,</span><span class="m">-1</span><span class="p">)))</span><span class="w"> </span><span class="c1">#mean unemployment between 2000-2005
</span><span class="n">unemp</span><span class="o">$</span><span class="n">unemp</span><span class="o">&lt;-</span><span class="n">unemp</span><span class="o">$</span><span class="n">Z</span><span class="o">/</span><span class="m">5</span><span class="w">
</span><span class="n">unemp</span><span class="o">&lt;-</span><span class="n">unemp</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">8</span><span class="p">)]</span><span class="w">
</span><span class="n">b</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Alborz"</span><span class="p">,</span><span class="s2">" "</span><span class="p">)</span><span class="w"> </span><span class="c1">#add data for missing Alborz (wasn't it's own province, based on research 14.9 selected)
</span><span class="n">unemp</span><span class="o">&lt;-</span><span class="n">rbind</span><span class="p">(</span><span class="n">unemp</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w">
</span><span class="n">unemp</span><span class="p">[</span><span class="m">31</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="o">&lt;</span><span class="m">-14.9</span><span class="w">
</span><span class="n">unemp</span><span class="o">$</span><span class="n">unemp</span><span class="o">&lt;-</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">unemp</span><span class="o">$</span><span class="n">unemp</span><span class="p">)</span><span class="w">
</span><span class="n">unemp</span><span class="o">&lt;-</span><span class="n">arrange</span><span class="p">(</span><span class="n">unemp</span><span class="p">,</span><span class="w"> </span><span class="n">province</span><span class="p">)</span><span class="w">
</span><span class="n">unemp.avg</span><span class="o">&lt;-</span><span class="n">unemp</span><span class="o">$</span><span class="n">unemp</span><span class="w">
</span><span class="n">final</span><span class="o">&lt;-</span><span class="n">cbind</span><span class="p">(</span><span class="n">final</span><span class="p">,</span><span class="n">unemp.avg</span><span class="p">)</span><span class="w">

</span><span class="c1">###Create table for means of measurements
</span><span class="n">library</span><span class="p">(</span><span class="n">formattable</span><span class="p">)</span><span class="w">

</span><span class="n">SummaryTable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
  </span><span class="n">Variables</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Reformist Vote Share 2016"</span><span class="p">,</span><span class="s2">"Independent Vote Share 2016"</span><span class="p">,</span><span class="s2">"Principalist Vote Share 2016"</span><span class="p">,</span><span class="s2">"Rouhani Vote Share 2013"</span><span class="p">,</span><span class="s2">"Unemployment Rate"</span><span class="p">,</span><span class="s2">"Gini Index"</span><span class="p">,</span><span class="s2">"GDP/capita"</span><span class="p">),</span><span class="w">
  </span><span class="n">Mean</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"51%"</span><span class="p">,</span><span class="s2">"16%"</span><span class="p">,</span><span class="s2">"34%"</span><span class="p">,</span><span class="s2">"53%"</span><span class="p">,</span><span class="s2">"12.04%"</span><span class="p">,</span><span class="s2">"0.31"</span><span class="p">,</span><span class="s2">"105993"</span><span class="p">),</span><span class="w">
  </span><span class="n">Minimum</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"0%"</span><span class="p">,</span><span class="s2">"0%"</span><span class="p">,</span><span class="s2">"0%"</span><span class="p">,</span><span class="s2">"33%"</span><span class="p">,</span><span class="s2">"1.42%"</span><span class="p">,</span><span class="s2">"0.25"</span><span class="p">,</span><span class="s2">"49962"</span><span class="p">),</span><span class="w">
  </span><span class="n">Maximum</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"100%"</span><span class="p">,</span><span class="s2">"50%"</span><span class="p">,</span><span class="s2">"100%"</span><span class="p">,</span><span class="s2">"73%"</span><span class="p">,</span><span class="s2">"21.04%"</span><span class="p">,</span><span class="s2">"0.38"</span><span class="p">,</span><span class="s2">"337586"</span><span class="p">),</span><span class="w">
  </span><span class="n">Tehran</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"94%"</span><span class="p">,</span><span class="s2">"0%"</span><span class="p">,</span><span class="s2">"6%"</span><span class="p">,</span><span class="s2">"49%"</span><span class="p">,</span><span class="s2">"12%"</span><span class="p">,</span><span class="s2">"0.31"</span><span class="p">,</span><span class="s2">"178774"</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">formattable</span><span class="p">(</span><span class="n">SummaryTable</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
  </span><span class="n">Variables</span><span class="o">=</span><span class="w"> </span><span class="n">formatter</span><span class="p">(</span><span class="w">
    </span><span class="s2">"span"</span><span class="p">,</span><span class="w">
    </span><span class="n">style</span><span class="o">=</span><span class="n">x</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">style</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w">
                    </span><span class="n">font.weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">,</span><span class="w">
                    </span><span class="n">background.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00ff00"</span><span class="p">,</span><span class="w">
                    </span><span class="n">border.radius</span><span class="o">=</span><span class="s2">"4px"</span><span class="p">,</span><span class="w">
                    </span><span class="n">display</span><span class="o">=</span><span class="s2">"block"</span><span class="p">,</span><span class="w">
                    </span><span class="n">padding</span><span class="o">=</span><span class="w"> </span><span class="s2">"0 4px"</span><span class="p">),</span><span class="w">
    </span><span class="n">Tehran</span><span class="o">=</span><span class="w"> </span><span class="n">formatter</span><span class="p">(</span><span class="w">
      </span><span class="s2">"span"</span><span class="p">,</span><span class="w">
      </span><span class="n">style</span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">style</span><span class="p">(</span><span class="n">font.weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="p">)</span></code></pre></figure>

<table class="table table-condensed">
 <thead>
  <tr>
   <th style="text-align:right;"> Variables </th>
   <th style="text-align:right;"> Mean </th>
   <th style="text-align:right;"> Minimum </th>
   <th style="text-align:right;"> Maximum </th>
   <th style="text-align:right;"> Tehran </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> <span style="color: black; font-weight: bold; background-color: #00ff00; border-radius: 4px; display: block; padding: 0 4px" tehran="&lt;span style=&quot;font-weight: bold&quot;&gt;Reformist Vote Share 2016   &lt;/span&gt;">Reformist Vote Share 2016   </span> </td>
   <td style="text-align:right;"> 51% </td>
   <td style="text-align:right;"> 0% </td>
   <td style="text-align:right;"> 100% </td>
   <td style="text-align:right;"> 94% </td>
  </tr>
  <tr>
   <td style="text-align:right;"> <span style="color: black; font-weight: bold; background-color: #00ff00; border-radius: 4px; display: block; padding: 0 4px" tehran="&lt;span style=&quot;font-weight: bold&quot;&gt;Independent Vote Share 2016 &lt;/span&gt;">Independent Vote Share 2016 </span> </td>
   <td style="text-align:right;"> 16% </td>
   <td style="text-align:right;"> 0% </td>
   <td style="text-align:right;"> 50% </td>
   <td style="text-align:right;"> 0% </td>
  </tr>
  <tr>
   <td style="text-align:right;"> <span style="color: black; font-weight: bold; background-color: #00ff00; border-radius: 4px; display: block; padding: 0 4px" tehran="&lt;span style=&quot;font-weight: bold&quot;&gt;Principalist Vote Share 2016&lt;/span&gt;">Principalist Vote Share 2016</span> </td>
   <td style="text-align:right;"> 34% </td>
   <td style="text-align:right;"> 0% </td>
   <td style="text-align:right;"> 100% </td>
   <td style="text-align:right;"> 6% </td>
  </tr>
  <tr>
   <td style="text-align:right;"> <span style="color: black; font-weight: bold; background-color: #00ff00; border-radius: 4px; display: block; padding: 0 4px" tehran="&lt;span style=&quot;font-weight: bold&quot;&gt;Rouhani Vote Share 2013     &lt;/span&gt;">Rouhani Vote Share 2013     </span> </td>
   <td style="text-align:right;"> 53% </td>
   <td style="text-align:right;"> 33% </td>
   <td style="text-align:right;"> 73% </td>
   <td style="text-align:right;"> 49% </td>
  </tr>
  <tr>
   <td style="text-align:right;"> <span style="color: black; font-weight: bold; background-color: #00ff00; border-radius: 4px; display: block; padding: 0 4px" tehran="&lt;span style=&quot;font-weight: bold&quot;&gt;Unemployment Rate           &lt;/span&gt;">Unemployment Rate           </span> </td>
   <td style="text-align:right;"> 12.04% </td>
   <td style="text-align:right;"> 1.42% </td>
   <td style="text-align:right;"> 21.04% </td>
   <td style="text-align:right;"> 12% </td>
  </tr>
  <tr>
   <td style="text-align:right;"> <span style="color: black; font-weight: bold; background-color: #00ff00; border-radius: 4px; display: block; padding: 0 4px" tehran="&lt;span style=&quot;font-weight: bold&quot;&gt;Gini Index                  &lt;/span&gt;">Gini Index                  </span> </td>
   <td style="text-align:right;"> 0.31 </td>
   <td style="text-align:right;"> 0.25 </td>
   <td style="text-align:right;"> 0.38 </td>
   <td style="text-align:right;"> 0.31 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> <span style="color: black; font-weight: bold; background-color: #00ff00; border-radius: 4px; display: block; padding: 0 4px" tehran="&lt;span style=&quot;font-weight: bold&quot;&gt;GDP/capita                  &lt;/span&gt;">GDP/capita                  </span> </td>
   <td style="text-align:right;"> 105993 </td>
   <td style="text-align:right;"> 49962 </td>
   <td style="text-align:right;"> 337586 </td>
   <td style="text-align:right;"> 178774 </td>
  </tr>
</tbody>
</table>

<p>#Graph elections</p>

<p>Now that I have the data scraped, cleaned, and combined, I can easily create an interactive map displaying not only both elections data but also the socioeconomic data I scraped earlier as well.</p>

<p>Workflow:</p>

<ul>
  <li>Create function to download shapefiles from online sources</li>
  <li>Download shapefile and clean data slot</li>
  <li>Create ggplot2 object (static map)</li>
  <li>Wrap plotly arround ggplot2 object and map (interactive map)</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">###Maps
#Function to download and import shapefile
</span><span class="n">dlshape</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">shploc</span><span class="p">,</span><span class="w"> </span><span class="n">shpfile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">temp</span><span class="o">=</span><span class="n">tempfile</span><span class="p">()</span><span class="w">
  </span><span class="n">download.file</span><span class="p">(</span><span class="n">shploc</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">)</span><span class="w">
  </span><span class="n">unzip</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w">
  </span><span class="n">shp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">fp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">readOGR</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span><span class="n">shpfile</span><span class="p">))</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="n">iran.sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dlshape</span><span class="p">(</span><span class="n">shploc</span><span class="o">=</span><span class="s2">"http://biogeo.ucdavis.edu/data/gadm2.8/shp/IRN_adm_shp.zip"</span><span class="p">,</span><span class="s2">"IRN_adm1"</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">FALSE OGR data source with driver: ESRI Shapefile 
FALSE Source: ".", layer: "IRN_adm1"
FALSE with 31 features
FALSE It has 12 fields</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Align spelling of provinces
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">rename</span><span class="p">(</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">province</span><span class="o">=</span><span class="n">NAME_1</span><span class="p">)</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">)</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Hamadan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Hamedan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Esfahan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Isfahan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Razavi Khorasan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Khorasan Razavi"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"North Khorasan "</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"North Khorasan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"South Khorasan "</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"South Khorasan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Chahar Mahall and Bakhtiari"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Chahar Mahal and Bakhtiari"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Kordestan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Kurdistan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Chahar Mahall and Bakhtiari"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Chahar Mahal and Bakhtiari"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"West Azarbaijan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"West Azerbaijan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"East Azarbaijan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"East Azerbaijan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Ardebil"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Ardabil"</span><span class="w">

</span><span class="c1">#Apparenltly the shapefile's names do not match up with the coordinate locations -i.e. they're jumbled up
#So first create a copy of the province column
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="o">&lt;-</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Fars"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Isfahan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Gilan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Fars"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Markazi"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Mazandaran"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Isfahan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Ilam"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Lorestan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Markazi"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Hormozgan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Hamedan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Khuzestan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Kohgiluyeh and Buyer Ahmad"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Kohgiluyeh and Buyer Ahmad"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Kurdistan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Khorasan Razavi"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Khuzestan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Mazandaran"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"North Khorasan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Hamedan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Golestan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Golestan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Gilan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Qom"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Khorasan Razavi"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"North Khorasan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Qazvin"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Kurdistan"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Lorestan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Ilam"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Hormozgan"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">==</span><span class="s2">"Qazvin"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Qom"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province.og</span><span class="o">&lt;-</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province</span><span class="o">&lt;-</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">province2</span><span class="o">&lt;-</span><span class="kc">NULL</span><span class="w">

</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="o">&lt;-</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"7"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"6"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"8"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"7"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"19"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"20"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"6"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"12"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"18"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"19"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"11"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"10"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"15"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"16"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"16"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"17"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"24"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"15"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"20"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"21"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"10"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"9"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"9"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"8"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"23"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"24"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"21"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"22"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"17"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"18"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"12"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"11"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="p">[</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">==</span><span class="s2">"22"</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"23"</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1.og</span><span class="o">&lt;-</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">&lt;-</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1a</span><span class="o">&lt;-</span><span class="kc">NULL</span><span class="w">

</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">final</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"province"</span><span class="p">,</span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="o">&lt;-</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">$</span><span class="n">ID_1</span><span class="p">)</span><span class="w">
</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">arrange</span><span class="p">(</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">desc</span><span class="p">(</span><span class="n">ID_1</span><span class="p">))</span><span class="w">

</span><span class="c1">##Render data into df format for mapping
</span><span class="n">iran_map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fortify</span><span class="p">(</span><span class="n">iran.sp</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="o">=</span><span class="s2">"ID_1"</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">iran_map</span><span class="p">,</span><span class="w"> </span><span class="n">iran.sp</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="o">=</span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="n">by.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="n">by.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ID_1"</span><span class="p">)</span><span class="w">

</span><span class="c1">###Plotly
#Rename variables to appropriate styles for display
</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">34</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Rouhani Vote Share 2013"</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">40</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Independent Vote Share 2016"</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">39</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Principalist Vote Share 2016"</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">8</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Province"</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">21</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"GDP/capita"</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">23</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Gini Index"</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">41</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Unemployment Rate"</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">38</span><span class="p">]</span><span class="o">&lt;-</span><span class="s2">"Reformist Vote Share 2016"</span><span class="w">

</span><span class="c1">#ggplot the map
</span><span class="n">p</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`Reformist Vote Share 2016`</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w">
                    </span><span class="n">label</span><span class="o">=</span><span class="n">`Independent Vote Share 2016`</span><span class="p">,</span><span class="w">
                    </span><span class="n">label2</span><span class="o">=</span><span class="n">`Principalist Vote Share 2016`</span><span class="p">,</span><span class="w">
                    </span><span class="n">label3</span><span class="o">=</span><span class="n">`Rouhani Vote Share 2013`</span><span class="p">,</span><span class="w">
                    </span><span class="n">label4</span><span class="o">=</span><span class="n">`Unemployment Rate`</span><span class="p">,</span><span class="w">
                    </span><span class="n">label5</span><span class="o">=</span><span class="n">`Gini Index`</span><span class="p">,</span><span class="w">
                    </span><span class="n">label6</span><span class="o">=</span><span class="n">`GDP/capita`</span><span class="p">,</span><span class="w">
                    </span><span class="n">label7</span><span class="o">=</span><span class="n">Province</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_polygon</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Reformist Vote Share 2016"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_gradient</span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lightgrey"</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"darkred"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s1">'Vote Share'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="n">xlab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span><span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">axis.line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">axis.line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">))</span><span class="w">

</span><span class="c1">#Convert to plotly object
</span><span class="n">gg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plotly_build</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">

</span><span class="c1">#Get rid of hover-over edit toolbar
</span><span class="n">gg</span><span class="o">&lt;-</span><span class="n">gg</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">config</span><span class="p">(</span><span class="n">displayModeBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">config</span><span class="p">(</span><span class="n">showLink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1">#Save to plotly account
</span><span class="n">plotly_POST</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"iran.plotly.100"</span><span class="p">)</span></code></pre></figure>

<iframe src="https://plot.ly/~cmohamma/36.embed" width="800" height="600" id="igraph" scrolling="no" seamless="seamless" frameborder="0"> </iframe>

<p>The map above shows the distribution of reformist vote share by province. The reformist enjoyed greatest support in Yazd, Qazvin, and Tehran, while principalist were most successful in South Khorasan, Markazi, and Kermanshah provinces. In terms of the presidential race, Sistan and Baluchestan, Kurdistan, and Yazd are where the reformist candidate Rouhani enjoyed his best success, while he fared the poorest in Chahar Mahal and Bakhtiar, Khuzestan, and Qom.</p>

<p>How consistent is the support for reformist backed candidates across the presidential and legislative elections? The bar plot below shows the first difference between the reformist backed candidates vote share in the legislative elections and Rouhani’s vote share in 2014. Positive values (blue) indicate an increase in reformist vote share in 2016 relative to Rouhani’s vote share in that same province in 2014. Provinces with negative values (red) are those provinces in 2016 where reformist vote share in the Majles elections shrank relative to reformist performance during the presidential elections in 2014.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">cowplot</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">f.diff</span><span class="o">&lt;-</span><span class="n">data</span><span class="p">[,</span><span class="m">38</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[,</span><span class="m">34</span><span class="p">]</span><span class="w">

</span><span class="n">plot.df</span><span class="o">&lt;-</span><span class="n">unique</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">42</span><span class="p">))</span><span class="w">

</span><span class="n">plot.df</span><span class="o">$</span><span class="n">category</span><span class="o">&lt;-</span><span class="n">ifelse</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">plot.df</span><span class="o">$</span><span class="n">f.diff</span><span class="p">)</span><span class="o">&lt;</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">plot.df</span><span class="o">$</span><span class="n">category</span><span class="o">&lt;-</span><span class="n">as.factor</span><span class="p">(</span><span class="n">plot.df</span><span class="o">$</span><span class="n">category</span><span class="p">)</span><span class="w">

</span><span class="n">plot.df</span><span class="o">$</span><span class="n">Province</span><span class="o">&lt;-</span><span class="n">factor</span><span class="p">(</span><span class="n">plot.df</span><span class="o">$</span><span class="n">Province</span><span class="p">,</span><span class="w"> 
                         </span><span class="n">levels</span><span class="o">=</span><span class="n">plot.df</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">plot.df</span><span class="o">$</span><span class="n">f.diff</span><span class="p">),</span><span class="w"> </span><span class="s2">"Province"</span><span class="p">])</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">plot.df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Province</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">f.diff</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">category</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">),</span><span class="w"> 
        </span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Province</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Province</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f.diff</span><span class="p">),</span><span class="w"> 
            </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.35</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">axis.ticks.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">axis.line.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Reformist Vote Share \n Legislative (2016) - Presidential (2014)"</span><span class="p">)</span></code></pre></figure>

<p><img src="figure/source/2016-06-12-iranelections/unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" style="display: block; margin: auto 0 auto auto;" /></p>

<p>#Economic well-being and the reformist vote at the provincial level</p>

<p>So what does provincial level GDP (excluding oil output) tell us about Iranian voting habits? The conventional wisdom, in regards to divisions in Iranian politics, tells us that voting habits fall along class differences. The data, however, provides a more complex picture. Correlations between reformist vote share and unemployment, income inequality, and GDP growth all hover closer to zero. The correlation, however, between GDP/capita and reformist vote share at the provencial level is about 0.46, which suggests a weak relationship between the two at best. Linear regression analysis predicting vote share that includes each of the aforementioned economic indicators finds a positive and statistically significant, albiet weak, relationship between GDP/capita and reformist vote share only. At best, this analysis identifies a small relationship between economic well-being and Iranian voting habits, however, given the sample size of a single election and the problems associated with aggregating votes at the provincial level (as opposed to presinct level), these conclusions should be taken with a grain of salt. If economic well-being is a poor predictor of Iranian voting behavior, what factors might explain Iranian voter choice in 2016? Factors this analysis has overlooked include incumbency, religiousity, ethnicity, and education.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">data.df</span><span class="o">&lt;-</span><span class="n">iran.sp</span><span class="o">@</span><span class="n">data</span><span class="w">

</span><span class="c1">#Generate maps
</span><span class="n">library</span><span class="p">(</span><span class="n">gridExtra</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="w">

</span><span class="n">g</span><span class="m">1</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data.df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">gdp.cap</span><span class="p">,</span><span class="w"> </span><span class="n">reform_rat</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"GDP/capita"</span><span class="p">)</span><span class="o">+</span><span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="m">2</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data.df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">gdp.grow</span><span class="p">,</span><span class="w"> </span><span class="n">reform_rat</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"GDP Growth"</span><span class="p">)</span><span class="o">+</span><span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="m">3</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data.df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">unemp.avg</span><span class="p">,</span><span class="w"> </span><span class="n">reform_rat</span><span class="p">))</span><span class="o">+</span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Unemployment"</span><span class="p">)</span><span class="o">+</span><span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="m">4</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data.df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">gini</span><span class="p">,</span><span class="w"> </span><span class="n">reform_rat</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Gini Coefficient"</span><span class="p">)</span><span class="o">+</span><span class="n">ylab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="w">

</span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">g</span><span class="m">1</span><span class="p">,</span><span class="n">g</span><span class="m">2</span><span class="p">,</span><span class="n">g</span><span class="m">3</span><span class="p">,</span><span class="n">g</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textGrob</span><span class="p">(</span><span class="s2">"Reformist Vote Share"</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="o">=</span><span class="n">gpar</span><span class="p">(</span><span class="n">fontface</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="m">22</span><span class="p">)))</span></code></pre></figure>

<p><img src="figure/source/2016-06-12-iranelections/unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" style="display: block; margin: auto 0 auto auto;" /></p>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>See https://www.jacobinmag.com/2016/05/iran-elections-rouhani-reformists-nuclear-deal/ for an example. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Where's the Data?</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Where's the Data?</li>
          <li><a href="mailto:cmohamma@gmail.com">cmohamma@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/cmohamma">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">cmohamma</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">My musings on politics, pop culture, sports, and pretty much anything else I can find data on.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
